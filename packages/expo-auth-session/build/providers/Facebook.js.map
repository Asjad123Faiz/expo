{"version":3,"file":"Facebook.js","sourceRoot":"","sources":["../../src/providers/Facebook.ts"],"names":[],"mappings":"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","sourcesContent":["import Constants from 'expo-constants';\nimport { Platform } from 'react-native';\n\nimport { useAuthRequestResult, useLoadedAuthRequest } from '../AuthRequestHooks';\nimport {\n  AuthRequest,\n  AuthRequestPromptOptions,\n  AuthSessionRedirectUriOptions,\n  AuthSessionResult,\n  DiscoveryDocument,\n  makeRedirectUri,\n  ResponseType,\n} from '../AuthSession';\nimport { requestAsync } from '../Fetch';\nimport { TokenResponse } from '../TokenRequest';\nimport { ProviderAuthRequestConfig, ProviderUser } from './Provider.types';\n\nconst settings = {\n  windowFeatures: { width: 700, height: 600 },\n  // These are required for Firebase to work properly which is a reasonable default.\n  minimumScopes: ['public_profile', 'email'],\n};\n\nexport const discovery: DiscoveryDocument = {\n  authorizationEndpoint: 'https://www.facebook.com/v6.0/dialog/oauth',\n  tokenEndpoint: 'https://graph.facebook.com/v6.0/oauth/access_token',\n};\n\nexport interface FacebookAuthRequestConfig extends ProviderAuthRequestConfig {\n  webClientId?: string;\n  iosClientId?: string;\n  androidClientId?: string;\n  expoClientId?: string;\n}\n\nfunction applyRequiredScopes(scopes: string[] = []): string[] {\n  // Add the required scopes for returning profile data.\n  const requiredScopes = [...scopes, ...settings.minimumScopes];\n  // Remove duplicates\n  return [...new Set(requiredScopes)];\n}\n\nclass FacebookAuthRequest extends AuthRequest {\n  constructor({\n    language,\n    selectAccount,\n    extraParams = {},\n    clientSecret,\n    ...config\n  }: FacebookAuthRequestConfig) {\n    const inputParams: Record<string, string> = {\n      display: 'popup',\n      ...extraParams,\n    };\n    if (language) inputParams.locale = language;\n    if (selectAccount && !inputParams.auth_type) inputParams.auth_type = 'reauthenticate';\n\n    // Apply the default scopes\n    const scopes = applyRequiredScopes(config.scopes);\n    let inputClientSecret: string | undefined;\n    //  Facebook will throw if you attempt to use the client secret\n    if (config.responseType && config.responseType !== ResponseType.Code) {\n      // TODO: maybe warn that you shouldn't store the client secret on the client\n      inputClientSecret = clientSecret;\n    }\n    super({\n      ...config,\n      clientSecret: inputClientSecret,\n      scopes,\n      extraParams: inputParams,\n    });\n  }\n}\n\n// Only natively in the Expo client.\nfunction shouldUseProxy(): boolean {\n  return Platform.select({\n    web: false,\n    // Use the proxy in the Expo client.\n    default: !!Constants.manifest && Constants.appOwnership !== 'standalone',\n  });\n}\n\n/**\n * Load an authorization request.\n * Returns a loaded request, a response, and a prompt method.\n * When the prompt method completes then the response will be fulfilled.\n *\n *  - TODO: Put Getting started guide URL here\n *\n * @param config\n * @param discovery\n */\nexport function useAuthRequest(\n  config: Partial<FacebookAuthRequestConfig> = {},\n  redirectUriOptions: Partial<AuthSessionRedirectUriOptions> = {}\n): [\n  FacebookAuthRequest | null,\n  AuthSessionResult | null,\n  (options?: AuthRequestPromptOptions) => Promise<AuthSessionResult>\n] {\n  const useProxy = redirectUriOptions.useProxy ?? shouldUseProxy();\n\n  if (typeof config.redirectUri === 'undefined') {\n    config.redirectUri = makeRedirectUri({\n      native: `fb${config.clientId}://authorize`,\n      useProxy,\n      ...redirectUriOptions,\n      // native: `com.googleusercontent.apps.${guid}:/oauthredirect`,\n    });\n  }\n\n  const request = useLoadedAuthRequest(\n    config as FacebookAuthRequestConfig,\n    discovery,\n    FacebookAuthRequest\n  );\n\n  const [result, promptAsync] = useAuthRequestResult(request, discovery, {\n    windowFeatures: settings.windowFeatures,\n    useProxy,\n  });\n\n  return [request, result, promptAsync];\n}\n\n/**\n * Fetch generic user info from the provider's OpenID Connect `userInfoEndpoint` (if supported).\n *\n * [UserInfo](https://openid.net/specs/openid-connect-core-1_0.html#UserInfo)\n *\n * @param config The `accessToken` for a user, returned from a code exchange or auth request.\n * @param discovery The `userInfoEndpoint` for a provider.\n */\nexport async function fetchUserInfoAsync(\n  response: Pick<TokenResponse, 'accessToken'>\n): Promise<ProviderUser> {\n  const providerData = await requestAsync<Record<string, any>>(\n    `https://graph.facebook.com/me?fields=name,email,picture?access_token=${response.accessToken}`,\n    {\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n      },\n      dataType: 'json',\n      method: 'GET',\n    }\n  );\n\n  const user = {\n    name: providerData.name,\n    email: providerData.email,\n    id: providerData.id,\n    picture: providerData.picture.data.url,\n    providerData,\n  };\n  return user;\n}\n"]}